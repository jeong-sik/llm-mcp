(tests
 (names test_types test_tools test_mcp_server test_binaries test_msgpack_size test_input_compression test_dictionary test_parallel test_cli_runner test_common test_mcp_session test_sse test_notification_sse test_run_log test_agent_core test_agent_core_stress test_agent_soak_1min test_ollama_backend test_claude_cli_backend test_openai_backend)
 (modules (:standard \ test_agent_soak_1hour test_ollama_integration))
 (libraries llm_mcp llm_mcp.agent_core alcotest alcotest-lwt lwt lwt.unix str zstd domainslib)
 (preprocess (pps lwt_ppx)))

; Long-running soak test (run manually with duration argument)
(executable
 (name test_agent_soak_1hour)
 (modules test_agent_soak_1hour)
 (libraries llm_mcp.agent_core lwt lwt.unix)
 (preprocess (pps lwt_ppx)))

; Ollama integration test (requires OLLAMA_TEST=1)
(executable
 (name test_ollama_integration)
 (modules test_ollama_integration)
 (libraries llm_mcp.agent_core alcotest lwt lwt.unix str)
 (preprocess (pps lwt_ppx)))

; Eio-based tests (separate stanza - no lwt_ppx)
(test
 (name test_agent_core_eio)
 (libraries agent_core_eio alcotest eio eio_main))

; Validator Eio tests
(test
 (name test_validator_eio)
 (libraries llm_mcp.agent_core_eio eio eio_main))

; Lwt/Eio bridge tests
(test
 (name test_lwt_bridge)
 (libraries agent_core_bridge alcotest eio eio_main lwt lwt.unix lwt_eio str))
