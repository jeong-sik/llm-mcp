; Core tests (no agent_core dependency)
(tests
 (names test_types test_tools test_mcp_server test_binaries test_msgpack_size test_protocol_invariants test_input_compression test_dictionary test_parallel test_cli_runner test_common test_mcp_session test_sse test_notification_sse test_run_log)
 (modules (:standard \ test_ollama_integration test_agent_core_eio test_validator_eio test_lwt_bridge test_presets test_spec_dsl test_validation_stack test_orchestration_eio test_cli_runner_eio test_tools_eio test_mcp_server_eio test_tool_parsers))
 (libraries llm_mcp alcotest alcotest-lwt lwt lwt.unix str zstd domainslib)
 (preprocess (pps lwt_ppx)))

; Ollama integration test (requires OLLAMA_TEST=1)
(executable
 (name test_ollama_integration)
 (modules test_ollama_integration)
 (libraries llm_mcp.agent_core_eio alcotest eio eio_main str))

; Eio-based tests
(test
 (name test_agent_core_eio)
 (libraries llm_mcp.agent_core_eio alcotest eio eio_main))

; Validator Eio tests
(test
 (name test_validator_eio)
 (libraries llm_mcp.agent_core_eio eio eio_main))

; Lwt/Eio bridge tests
(test
 (name test_lwt_bridge)
 (libraries agent_core_bridge alcotest eio eio_main lwt lwt.unix lwt_eio str))

; Validator Presets tests
(test
 (name test_presets)
 (libraries llm_mcp.agent_core_eio eio eio_main))

; Spec DSL tests
(test
 (name test_spec_dsl)
 (libraries llm_mcp.agent_core_eio eio eio_main))

; Validation Stack tests
(test
 (name test_validation_stack)
 (libraries llm_mcp.agent_core_eio eio eio_main))

; Orchestration integration tests
(test
 (name test_orchestration_eio)
 (libraries llm_mcp.agent_core_eio eio eio_main))

; CLI Runner Eio tests
(test
 (name test_cli_runner_eio)
 (libraries llm_mcp.eio llm_mcp.common eio eio_main))

; Tools Eio tests
(test
 (name test_tools_eio)
 (libraries llm_mcp.eio llm_mcp.common eio eio_main))

; MCP Server Eio tests
(test
 (name test_mcp_server_eio)
 (libraries llm_mcp.eio llm_mcp.common alcotest eio eio_main))

; Tool_parsers pure function tests (NO Lwt, NO Eio)
(test
 (name test_tool_parsers)
 (libraries llm_mcp.common alcotest))

; Chain Engine tests (types, parser, compiler, registry)
(test
 (name test_chain_engine)
 (libraries llm_mcp.common alcotest))
