{
  "id": "walph-coverage",
  "name": "Walph Coverage Loop",
  "description": "Test coverage improvement loop - repeats until target coverage reached",
  "version": "1.1.0",
  "nodes": [
    {
      "id": "analyze",
      "type": "llm",
      "llm": {
        "model": "gemini",
        "prompt": "Analyze the following file for test coverage gaps:\n\nFile: {{target}}\n\nIdentify:\n1. Uncovered functions/branches\n2. Edge cases missing tests\n3. Priority order for test generation\n\nOutput JSON with structure: {\"gaps\": [...], \"priority\": [...]}"
      },
      "output_key": "analysis"
    },
    {
      "id": "coverage_loop",
      "type": "feedback_loop",
      "generator": {
        "id": "generate_tests",
        "type": "llm",
        "llm": {
          "model": "claude-cli",
          "prompt": "Based on this coverage analysis:\n{{analysis}}\n\nGenerate comprehensive tests for the highest priority gap.\nUse the project's existing test patterns.\n\nOutput only the test code."
        }
      },
      "evaluator_config": {
        "scoring_func": "anti_fake",
        "scoring_prompt": "Evaluate test quality:\n1. Does it test real behavior (not fake)?\n2. Does it cover edge cases?\n3. Is assertion meaningful?\n\nScore 0.0-1.0 based on anti_fake criteria.",
        "select_strategy": "best"
      },
      "improver_prompt": "The test scored {{score}} with feedback:\n{{feedback}}\n\nImprove the test to address:\n- Missing edge cases\n- Weak assertions\n- Fake test patterns\n\nOutput improved test code only.",
      "max_iterations": 10,
      "score_threshold": 0.85,
      "score_operator": "gte",
      "conversational": true,
      "relay_models": ["claude-cli", "gemini"],
      "depends_on": ["analyze"]
    }
  ],
  "output": "coverage_loop",
  "metadata": {
    "tags": ["walph", "coverage", "testing"],
    "category": "quality",
    "estimated_duration_sec": 120,
    "stop_conditions": {
      "goal": "coverage >= 90%",
      "max_iterations": 10,
      "drain": false
    }
  }
}
