{
  "id": "deep-research",
  "name": "Deep Research Pipeline",
  "description": "Multi-source research with fact-checking and synthesis",
  "version": "1.0.0",
  "nodes": [
    {
      "id": "query-expansion",
      "type": "llm",
      "llm": {
        "model": "gemini",
        "prompt": "Expand this research query into 3-5 specific sub-questions that would help thoroughly answer it.\n\nQuery: {{input.query}}\n\nOutput as JSON: {\"sub_queries\": [\"q1\", \"q2\", \"q3\"]}"
      },
      "output_key": "expanded_queries"
    },
    {
      "id": "web-search",
      "type": "fanout",
      "fanout": {
        "items": "{{expanded_queries.sub_queries}}",
        "node": {
          "id": "search-{{$index}}",
          "type": "tool",
          "tool": {
            "server": "web-search",
            "name": "search",
            "args": { "query": "{{$item}}", "max_results": 5 }
          }
        }
      },
      "depends_on": ["query-expansion"],
      "output_key": "search_results"
    },
    {
      "id": "extract-facts",
      "type": "llm",
      "llm": {
        "model": "claude-cli",
        "prompt": "Extract key facts from these search results. For each fact, note the source.\n\nSearch Results:\n{{search_results}}\n\nOutput as JSON: {\"facts\": [{\"claim\": \"...\", \"source\": \"...\", \"confidence\": 0.0-1.0}]}"
      },
      "depends_on": ["web-search"],
      "output_key": "extracted_facts"
    },
    {
      "id": "fact-check",
      "type": "llm",
      "llm": {
        "model": "codex",
        "prompt": "Cross-reference these facts. Identify:\n1. Facts supported by multiple sources (high confidence)\n2. Contradictory claims (needs resolution)\n3. Single-source facts (lower confidence)\n\nFacts:\n{{extracted_facts}}\n\nOutput as JSON: {\"verified\": [...], \"contradictions\": [...], \"unverified\": [...]}"
      },
      "depends_on": ["extract-facts"],
      "output_key": "fact_check_results"
    },
    {
      "id": "synthesize",
      "type": "llm",
      "llm": {
        "model": "gemini",
        "prompt": "Synthesize a comprehensive answer to the original query based on verified facts.\n\nOriginal Query: {{input.query}}\n\nVerified Facts:\n{{fact_check_results.verified}}\n\nContradictions to address:\n{{fact_check_results.contradictions}}\n\nWrite a well-structured research report with:\n1. Executive Summary\n2. Key Findings (with citations)\n3. Areas of Uncertainty\n4. Recommendations for Further Research\n\nUse markdown formatting."
      },
      "depends_on": ["fact-check"],
      "output_key": "research_report"
    },
    {
      "id": "generate-citations",
      "type": "llm",
      "llm": {
        "model": "gemini",
        "prompt": "Generate a bibliography from the sources used.\n\nFacts with sources:\n{{extracted_facts}}\n\nOutput in APA format."
      },
      "depends_on": ["extract-facts"],
      "output_key": "bibliography"
    },
    {
      "id": "final-assembly",
      "type": "llm",
      "llm": {
        "model": "claude-cli",
        "prompt": "Combine the research report and bibliography into a final document.\n\nReport:\n{{research_report}}\n\nBibliography:\n{{bibliography}}\n\nFormat as a complete research document with proper sections."
      },
      "depends_on": ["synthesize", "generate-citations"],
      "output_key": "final_document"
    }
  ],
  "input_schema": {
    "type": "object",
    "properties": {
      "query": {
        "type": "string",
        "description": "Research question to investigate"
      }
    },
    "required": ["query"]
  },
  "metadata": {
    "author": "Chain Engine",
    "tags": ["research", "fact-check", "synthesis", "multi-source"],
    "estimated_duration_sec": 180,
    "estimated_cost_usd": 0.25
  }
}
