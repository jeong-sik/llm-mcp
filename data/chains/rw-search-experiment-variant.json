{
  "id": "rw-search-experiment-variant",
  "name": "Search - Experiment Variant",
  "description": "Propose variants and validate visual drift for Search (query and results UX).",
  "version": "1.0.0",
  "nodes": [
    {
      "id": "figma-parse",
      "type": "tool",
      "tool": {
        "server": "figma",
        "name": "figma_parse_url",
        "args": {
          "url": "{{input.figma_url}}"
        }
      }
    },
    {
      "id": "figma-summary",
      "type": "tool",
      "tool": {
        "server": "figma",
        "name": "figma_get_node_summary",
        "args": {
          "file_key": "{{figma-parse.file_key}}",
          "node_id": "{{figma-parse.node_id}}",
          "max_children": 80
        }
      },
      "depends_on": [
        "figma-parse"
      ]
    },
    {
      "id": "figma-bundle",
      "type": "tool",
      "tool": {
        "server": "figma",
        "name": "figma_get_node_bundle",
        "args": {
          "file_key": "{{figma-parse.file_key}}",
          "node_id": "{{figma-parse.node_id}}",
          "depth": 4
        }
      },
      "depends_on": [
        "figma-parse"
      ]
    },
    {
      "id": "variant-ideas",
      "type": "llm",
      "llm": {
        "model": "gemini",
        "prompt": "Propose A/B variants for Search (query and results UX).\nOutput JSON with variants and hypotheses."
      },
      "depends_on": [
        "figma-summary"
      ]
    },
    {
      "id": "variant-html",
      "type": "llm",
      "llm": {
        "model": "codex",
        "prompt": "Generate HTML/CSS for the top variant for Search.\nVariants:\n{{variant-ideas}}"
      },
      "depends_on": [
        "variant-ideas"
      ]
    },
    {
      "id": "visual-verify",
      "type": "tool",
      "tool": {
        "server": "figma",
        "name": "figma_verify_visual",
        "args": {
          "file_key": "{{figma-parse.file_key}}",
          "node_id": "{{figma-parse.node_id}}",
          "html": "{{variant-html}}",
          "target_ssim": 0.9,
          "width": 1200,
          "height": 800
        }
      },
      "depends_on": [
        "figma-parse",
        "variant-html"
      ]
    },
    {
      "id": "evaluation",
      "type": "llm",
      "llm": {
        "model": "claude-cli",
        "prompt": "Evaluate variant feasibility for Search.\nVisual report:\n{{visual-verify}}\n\nVariants:\n{{variant-ideas}}"
      },
      "depends_on": [
        "visual-verify",
        "variant-ideas"
      ]
    },
    {
      "id": "task-list",
      "type": "llm",
      "llm": {
        "model": "codex",
        "prompt": "Create experiment tasks for Search.\nEvaluation:\n{{evaluation}}\n\nReturn ONLY JSON array of tasks with title/priority/description."
      },
      "depends_on": [
        "evaluation"
      ]
    },
    {
      "id": "masc-batch-add",
      "type": "tool",
      "tool": {
        "server": "masc",
        "name": "masc_batch_add_tasks",
        "args": {
          "tasks": "{{task-list}}"
        }
      },
      "depends_on": [
        "task-list"
      ]
    },
    {
      "id": "final-report",
      "type": "llm",
      "llm": {
        "model": "gemini",
        "prompt": "Summarize experiment proposal for Search.\nInclude hypothesis, SSIM result, and rollout steps."
      },
      "depends_on": [
        "evaluation",
        "task-list"
      ]
    }
  ],
  "output": "final-report",
  "input_schema": {
    "type": "object",
    "properties": {
      "figma_url": {
        "type": "string",
        "description": "Figma frame/component URL"
      },
      "base_url": {
        "type": "string",
        "description": "Web URL for audits"
      },
      "repo": {
        "type": "string",
        "description": "Repo identifier (owner/name)"
      },
      "branch": {
        "type": "string",
        "default": "main"
      },
      "locale": {
        "type": "string",
        "default": "en-US"
      },
      "feature_name": {
        "type": "string",
        "description": "Feature or screen label"
      },
      "incident_summary": {
        "type": "string",
        "description": "Incident summary text"
      },
      "service_name": {
        "type": "string",
        "description": "Service identifier for metrics"
      },
      "time_window": {
        "type": "string",
        "default": "24h"
      }
    },
    "required": [
      "figma_url"
    ]
  },
  "metadata": {
    "author": "Chain Engine",
    "tags": [
      "realworld-200",
      "masc",
      "figma",
      "llm",
      "search",
      "experiment-variant"
    ],
    "estimated_duration_sec": 180,
    "estimated_cost_usd": 0.2
  }
}
