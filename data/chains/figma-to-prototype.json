{
  "id": "figma-to-prototype",
  "name": "Figma to Prototype Generator",
  "description": "Figma 디자인에서 iOS/Android/Web 프로토타입 코드 생성",
  "version": "1.1.0",
  "nodes": [
    {
      "id": "parse-figma-url",
      "type": "tool",
      "tool": {
        "server": "figma",
        "name": "figma_parse_url",
        "args": { "url": "{{input.figma_url}}" }
      },
      "output_key": "figma_meta"
    },
    {
      "id": "get-design-structure",
      "type": "tool",
      "tool": {
        "server": "figma",
        "name": "figma_get_node_summary",
        "args": {
          "file_key": "{{figma_meta.file_key}}",
          "node_id": "{{figma_meta.node_id}}"
        }
      },
      "depends_on": ["parse-figma-url"],
      "output_key": "design_structure"
    },
    {
      "id": "extract-dsl",
      "type": "tool",
      "tool": {
        "server": "figma",
        "name": "figma_get_node_bundle",
        "args": {
          "file_key": "{{figma_meta.file_key}}",
          "node_id": "{{figma_meta.node_id}}",
          "depth": 3
        }
      },
      "depends_on": ["parse-figma-url"],
      "output_key": "figma_dsl"
    },
    {
      "id": "analyze-components",
      "type": "llm",
      "llm": {
        "model": "gemini",
        "prompt": "Analyze this Figma DSL and identify:\n1. Component hierarchy\n2. Reusable components\n3. Design tokens (colors, spacing, typography)\n4. Layout patterns (flex, grid, absolute)\n\nFigma DSL:\n{{figma_dsl}}\n\nOutput JSON: {\"components\": [...], \"tokens\": {...}, \"patterns\": [...]}"
      },
      "depends_on": ["extract-dsl"],
      "output_key": "component_analysis"
    },
    {
      "id": "generate-web",
      "type": "llm",
      "llm": {
        "model": "claude-cli",
        "prompt": "Generate React + Tailwind code for this Figma design.\n\nDesign Structure:\n{{design_structure}}\n\nComponent Analysis:\n{{component_analysis}}\n\nRequirements:\n- TypeScript\n- Functional components\n- Tailwind CSS (no inline styles)\n- Responsive (mobile-first)\n- Extract colors to CSS variables\n\n### Example Output (Button 120x48, blue, rounded-8):\n```tsx\ninterface ButtonProps {\n  label: string;\n  onClick?: () => void;\n}\n\nexport const Button: React.FC<ButtonProps> = ({ label, onClick }) => {\n  return (\n    <button\n      onClick={onClick}\n      className=\"w-[120px] h-[48px] bg-blue-500 hover:bg-blue-600 text-white font-semibold rounded-lg transition-colors\"\n    >\n      {label}\n    </button>\n  );\n};\n```\n\nOutput complete React component code following this pattern."
      },
      "depends_on": ["analyze-components", "get-design-structure"],
      "output_key": "web_code"
    },
    {
      "id": "generate-ios",
      "type": "llm",
      "llm": {
        "model": "codex",
        "prompt": "Generate SwiftUI code for this Figma design.\n\nDesign Structure:\n{{design_structure}}\n\nComponent Analysis:\n{{component_analysis}}\n\nRequirements:\n- SwiftUI (iOS 16+)\n- @ViewBuilder patterns\n- Preview provider\n- SF Symbols where appropriate\n- Dynamic Type support\n\n### Example Output (Button 120x48, blue, rounded-8):\n```swift\nimport SwiftUI\n\nstruct PrimaryButton: View {\n    let label: String\n    var action: () -> Void = {}\n    \n    var body: some View {\n        Button(action: action) {\n            Text(label)\n                .fontWeight(.semibold)\n                .foregroundColor(.white)\n                .frame(width: 120, height: 48)\n                .background(Color.blue)\n                .cornerRadius(8)\n        }\n    }\n}\n\n#Preview {\n    PrimaryButton(label: \"Submit\")\n}\n```\n\nIMPORTANT: Use ONLY valid SwiftUI modifiers. These do NOT exist: .text(), .rounded(), .center().\n\nOutput complete SwiftUI View code following this pattern."
      },
      "depends_on": ["analyze-components", "get-design-structure"],
      "output_key": "ios_code"
    },
    {
      "id": "generate-android",
      "type": "llm",
      "llm": {
        "model": "gemini",
        "prompt": "Generate Jetpack Compose code for this Figma design.\n\nDesign Structure:\n{{design_structure}}\n\nComponent Analysis:\n{{component_analysis}}\n\nRequirements:\n- Kotlin + Jetpack Compose\n- Material3 theme\n- @Preview annotations\n- Modifier patterns\n- State hoisting\n\n### Example Output (Button 120x48, blue, rounded-8):\n```kotlin\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.shape.RoundedCornerShape\nimport androidx.compose.material3.*\nimport androidx.compose.runtime.Composable\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.graphics.Color\nimport androidx.compose.ui.tooling.preview.Preview\nimport androidx.compose.ui.unit.dp\n\n@Composable\nfun PrimaryButton(\n    label: String,\n    onClick: () -> Unit = {},\n    modifier: Modifier = Modifier\n) {\n    Button(\n        onClick = onClick,\n        modifier = modifier\n            .width(120.dp)\n            .height(48.dp),\n        shape = RoundedCornerShape(8.dp),\n        colors = ButtonDefaults.buttonColors(\n            containerColor = Color(0xFF007AFF)\n        )\n    ) {\n        Text(label)\n    }\n}\n\n@Preview\n@Composable\nfun PrimaryButtonPreview() {\n    PrimaryButton(label = \"Submit\")\n}\n```\n\nOutput complete Composable code following this pattern."
      },
      "depends_on": ["analyze-components", "get-design-structure"],
      "output_key": "android_code"
    },
    {
      "id": "generate-flutter",
      "type": "llm",
      "llm": {
        "model": "codex",
        "prompt": "Generate Flutter/Dart code for this Figma design.\n\nDesign Structure:\n{{design_structure}}\n\nComponent Analysis:\n{{component_analysis}}\n\nRequirements:\n- Flutter 3.x\n- StatelessWidget/StatefulWidget\n- Theme.of(context) for styling\n- Responsive with MediaQuery\n- Extract to separate widgets\n\n### Example Output (Button 120x48, blue, rounded-8):\n```dart\nimport 'package:flutter/material.dart';\n\nclass PrimaryButton extends StatelessWidget {\n  final String label;\n  final VoidCallback? onPressed;\n\n  const PrimaryButton({\n    super.key,\n    required this.label,\n    this.onPressed,\n  });\n\n  @override\n  Widget build(BuildContext context) {\n    return SizedBox(\n      width: 120,\n      height: 48,\n      child: ElevatedButton(\n        onPressed: onPressed,\n        style: ElevatedButton.styleFrom(\n          backgroundColor: const Color(0xFF007AFF),\n          shape: RoundedRectangleBorder(\n            borderRadius: BorderRadius.circular(8),\n          ),\n        ),\n        child: Text(\n          label,\n          style: const TextStyle(\n            color: Colors.white,\n            fontWeight: FontWeight.w600,\n          ),\n        ),\n      ),\n    );\n  }\n}\n```\n\nOutput complete Flutter Widget code following this pattern."
      },
      "depends_on": ["analyze-components", "get-design-structure"],
      "output_key": "flutter_code"
    },
    {
      "id": "merge-outputs",
      "type": "llm",
      "llm": {
        "model": "claude-cli",
        "prompt": "Compile the generated prototypes into a structured report.\n\n## Web (React + Tailwind)\n{{web_code}}\n\n## iOS (SwiftUI)\n{{ios_code}}\n\n## Android (Jetpack Compose)\n{{android_code}}\n\n## Flutter\n{{flutter_code}}\n\nCreate a markdown report with:\n1. Overview of the design\n2. Shared design tokens (colors, spacing)\n3. Platform-specific code blocks\n4. Implementation notes per platform\n5. Known limitations/TODOs"
      },
      "depends_on": ["generate-web", "generate-ios", "generate-android", "generate-flutter"],
      "output_key": "final_report"
    }
  ],
  "input_schema": {
    "type": "object",
    "properties": {
      "figma_url": {
        "type": "string",
        "description": "Figma frame/component URL (e.g., https://www.figma.com/file/xxx/Design?node-id=1-2)"
      },
      "platforms": {
        "type": "array",
        "items": { "type": "string", "enum": ["web", "ios", "android", "flutter"] },
        "default": ["web", "ios", "android"],
        "description": "Target platforms to generate"
      }
    },
    "required": ["figma_url"]
  },
  "output_schema": {
    "type": "object",
    "properties": {
      "final_report": { "type": "string" },
      "web_code": { "type": "string" },
      "ios_code": { "type": "string" },
      "android_code": { "type": "string" },
      "flutter_code": { "type": "string" }
    }
  },
  "metadata": {
    "author": "Chain Engine",
    "tags": ["figma", "prototype", "code-generation", "multi-platform"],
    "estimated_duration_sec": 180,
    "estimated_cost_usd": 0.35
  }
}
