{
  "id": "walph-refactor",
  "name": "Walph Refactor",
  "description": "Refactoring with quality feedback loop",
  "version": "1.1.0",
  "nodes": [
    {
      "id": "analyze",
      "type": "llm",
      "llm": {
        "model": "gemini",
        "prompt": "Analyze this code for refactoring:\n\n{{input.code}}\n\nIdentify: code smells, complexity, naming issues, SOLID violations.\n\nOutput JSON: {\"issues\": [{\"type\": \"...\", \"location\": \"...\", \"suggestion\": \"...\"}], \"priority\": [...]}"
      },
      "output_key": "analysis"
    },
    {
      "id": "refactor_loop",
      "type": "feedback_loop",
      "generator": {
        "id": "refactor",
        "type": "llm",
        "llm": {
          "model": "claude-cli",
          "prompt": "Apply refactoring based on:\n{{analysis}}\n\nOriginal code:\n{{input.code}}\n\nOutput clean, refactored code."
        }
      },
      "evaluator_config": {
        "scoring_func": "anti_fake",
        "scoring_prompt": "Evaluate refactoring quality:\n1. Are issues actually fixed?\n2. Is code simpler/cleaner?\n3. No new bugs introduced?\n4. Follows best practices?\n\nScore 0.0-1.0",
        "select_strategy": "best"
      },
      "improver_prompt": "Refactoring scored {{score}}. Feedback:\n{{feedback}}\n\nImprove the refactored code to address feedback.\nOutput improved code only.",
      "max_iterations": 3,
      "score_threshold": 0.8,
      "score_operator": "gte",
      "depends_on": ["analyze"]
    }
  ],
  "output": "refactor_loop",
  "metadata": {
    "tags": ["walph", "refactor", "quality"],
    "estimated_duration_sec": 90
  }
}
